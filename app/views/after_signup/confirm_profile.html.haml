- title "Edit Profile"
.row
  .col-md-6.col-md-offset-3
    .panel.panel-default
      .panel-heading Public profile
      = render 'layouts/messages'
      .panel-body#panel-body
        = simple_form_for(@profile, url: wizard_path, method: :put) do |f|

          = f.error_notification
          .form-inputs
            %p Profile picture
            .fileinput.fileinput-new{"data-provides" => "fileinput"}
              .fileinput-new.thumbnail{:style => "width: 200px; height: 200px;"}
                - if @profile.avatar?
                  = image_tag(@profile.avatar.url, id: "edit-profile-avatar")
                -else
                  %img{"src" => "/images/200.gif"}
              .fileinput-preview.fileinput-exists.thumbnail{:style => "max-width: 200px; max-height: 200px;"}
              %div
                %span.btn.btn-default.btn-file
                  %span.fileinput-new Select image
                  %span.fileinput-exists Change
                  = f.file_field :avatar
                %a.btn.btn-default.fileinput-exists{"data-dismiss" => "fileinput", :href => "#"} Remove

            = f.input :first_name, required: true
            = f.input :last_name
            = f.input :job_title
            = f.input :phone, :input_html => { class:"form-control" }
            = f.input :age, required: true, class:"form-control"

            = f.input :domain_id, collection: @domains, class:"form-control", label: "Area of expertise"

            = f.input :university, input_html: { class: "form-control" }
            = f.input :bio
            = f.input :gender, label: 'What is your gender?', collection: [ ['Male', true ], ['Female', false] ], as: :radio_buttons

            .form-actions
              = f.button :submit, "Next", class: "btn btn-itunes-inversed btn-lg btn-block"

:scss
  main, body, html{
    margin: 0;
    padding: 0;
    padding-left: 15px;
    padding-right: 15px;
  }

:javascript
  $("#profile_address").geocomplete({
    details: "form",
    markerOptions: {
      draggable: true
    }
  });

  $('#profile_domain_id').selectize();
  
  $('#profile_university').selectize({
    maxItems: 1,
    persist: false,
    valueField: 'name',
    labelField: 'name',
    searchField: 'name',
    options: [],
    create: true,
    render: {
      option: function(item, escape) {
        var actors = [];
        for (var i = 0, n = item.length; i < n; i++) {
          actors.push('<span>' + escape(item.autocompletes[i].name) + '</span>');
        }

        return '<div>' +
                  '<span class="name">' + escape(item.name) + '</span>' +
               '</div>';
      }
    },
    load: function(query, callback) {
      if (!query.length) return callback();
      $.ajax({
        url: '/autocompletes/university.json',
        type: 'GET',
        dataType: 'json',
        data: {
          q: query,
        },
        error: function() {
          callback();
        },
        success: function(res) {
          callback(res.autocompletes);
        }
      });
    }
  });
